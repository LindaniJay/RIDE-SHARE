import{j as e}from"./query-CSyQ0w5Y.js";import{r as o}from"./vendor-CBH9K-97.js";import{a as M}from"./index-ngrFHoWO.js";import{u as I}from"./index-CWJzhqZF.js";import{d as R,c as E}from"./router-BWB2dKYR.js";import"./ui-qr7cu0yN.js";const q="http://localhost:5000/api",l=M.create({baseURL:q,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(a=>{const d=localStorage.getItem("accessToken");return d&&(a.headers.Authorization=`Bearer ${d}`),a});const L={getAll:a=>l.get("/vehicles",{params:a}),getById:a=>l.get(`/vehicles/${a}`),create:a=>l.post("/vehicles",a),update:(a,d)=>l.put(`/vehicles/${a}`,d),delete:a=>l.delete(`/vehicles/${a}`),search:a=>l.get("/vehicles/search",{params:a})},V={getAll:()=>l.get("/bookings"),getById:a=>l.get(`/bookings/${a}`),create:a=>l.post("/bookings",a),update:(a,d)=>l.put(`/bookings/${a}`,d),cancel:a=>l.post(`/bookings/${a}/cancel`),approve:a=>l.post(`/bookings/${a}/approve`),reject:a=>l.post(`/bookings/${a}/reject`)},B={createPaymentIntent:(a,d)=>l.post("/payments/create-payment-intent",{bookingId:a,amount:d}),confirmPayment:a=>l.post("/payments/confirm-payment",{paymentIntentId:a}),refund:a=>l.post("/payments/refund",{paymentId:a}),createPayfastPayment:a=>l.post("/payments/create-payfast-payment",a),getPaymentMethods:()=>l.get("/payments/methods")},F=({isOpen:a,onClose:d,bookingData:i,userInfo:t,onSuccess:k})=>{const[S,N]=o.useState([]),[s,f]=o.useState(""),[v,u]=o.useState(!1),[j,g]=o.useState("");o.useEffect(()=>{a&&w()},[a]);const w=async()=>{try{const n=await B.getPaymentMethods();N(n.data.methods||[]),f("payfast")}catch(n){console.error("Error fetching payment methods:",n)}},P=async()=>{var n,b;if(!s){g("Please select a payment method");return}u(!0),g("");try{if(s==="stripe")await B.createPaymentIntent(i.id,i.totalAmount),alert("Stripe integration would be implemented here"),k();else if(s==="payfast"){const m={bookingId:parseInt(i.id),amount:i.totalAmount,firstName:t.firstName,lastName:t.lastName,email:t.email,cellNumber:t.phone},h=await B.createPayfastPayment(m),y=document.createElement("form");y.method="POST",y.action=h.data.paymentUrl,h.data.payfastData&&Object.entries(h.data.payfastData).forEach(([c,C])=>{const r=document.createElement("input");r.type="hidden",r.name=c,r.value=C,y.appendChild(r)}),document.body.appendChild(y),y.submit()}}catch(m){const h=m instanceof Error&&"response"in m?(b=(n=m.response)==null?void 0:n.data)==null?void 0:b.error:"Payment failed. Please try again.";g(h||"Payment failed. Please try again.")}finally{u(!1)}},D=n=>`R${n.toLocaleString()}`;return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Complete Your Booking"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:i.vehicleName}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:[i.pickupDate," - ",i.returnDate]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["Total: ",D(i.totalAmount)]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Choose Payment Method"}),e.jsx("div",{className:"space-y-3",children:S.map(n=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${s===n.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:n.id,checked:s===n.id,onChange:b=>f(b.target.value),className:"mr-3 text-primary-600 focus:ring-primary-500"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:n.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:n.description})]})]})]},n.id))})]}),j&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-3 mb-4",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:j})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400 text-lg mr-2",children:"ℹ️"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Payment Security"}),e.jsx("p",{children:"Your payment is processed securely. You'll only be charged after the host confirms your booking. All transactions are protected by our insurance coverage."})]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:d,className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:v||!s,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:v?"Processing...":"Pay Now"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4",children:["By proceeding, you agree to our"," ",e.jsx("a",{href:"#",className:"text-primary-600 hover:text-primary-700",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"#",className:"text-primary-600 hover:text-primary-700",children:"Privacy Policy"})]})]})}):null},_=()=>{const{id:a}=R(),d=E(),{user:i}=I(),[t,k]=o.useState(null),[S,N]=o.useState(!0),[s,f]=o.useState({pickupDate:"",returnDate:"",totalDays:0,totalPrice:0,specialRequests:""}),[v,u]=o.useState(!1),[j,g]=o.useState(!1),[w,P]=o.useState(!1),[D,n]=o.useState(null);o.useEffect(()=>{b()},[a]);const b=async()=>{N(!0);try{const r=await L.getById(a);k(r.data)}catch(r){console.error("Error fetching vehicle:",r),k({id:a,make:"Toyota",model:"Hilux",year:2022,type:"bakkie",pricePerDay:250,location:"Cape Town, South Africa",images:["https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=800","https://images.unsplash.com/photo-1549317336-206569e8475c?w=800","https://images.unsplash.com/photo-1555215695-3004980dd54e?w=800"],features:["4WD","Air Conditioning","Bluetooth","GPS Navigation","Leather Seats","Backup Camera"],rating:4.8,reviewCount:24,description:"Perfect for your South African adventure! This reliable Toyota Hilux is ideal for exploring the beautiful landscapes of the Western Cape. With 4WD capabilities and all the modern features you need, it's perfect for both city driving and off-road adventures.",host:{id:"host1",name:"John M.",rating:4.9,responseTime:"1 hour",joinDate:"2022-03-15",totalTrips:47},availability:{startDate:"2024-01-01",endDate:"2024-12-31"}})}finally{N(!1)}},m=(r,p)=>{const x={...s,[r]:p};if(x.pickupDate&&x.returnDate){const A=new Date(x.pickupDate),$=new Date(x.returnDate),T=Math.ceil(($.getTime()-A.getTime())/(1e3*60*60*24));x.totalDays=T>0?T:0,x.totalPrice=x.totalDays*((t==null?void 0:t.pricePerDay)||0)}f(x)},h=async()=>{if(!i){d("/login");return}if(!t||s.totalDays<=0){alert("Please select valid dates");return}P(!0);try{const r={vehicleId:t.id,startDate:s.pickupDate,endDate:s.returnDate,totalDays:s.totalDays,totalPrice:s.totalPrice,specialRequests:s.specialRequests,status:"pending"},p=await V.create(r);n({id:p.data.id||"temp-id",totalAmount:s.totalPrice*1.1,vehicleName:`${t.make} ${t.model}`,pickupDate:s.pickupDate,returnDate:s.returnDate}),u(!1),g(!0)}catch(r){console.error("Booking error:",r),alert("Failed to create booking. Please try again.")}finally{P(!1)}},y=()=>{g(!1),alert("Payment successful! Your booking is confirmed."),d("/dashboard")},c=r=>`R${r.toLocaleString()}`,C=r=>({car:"🚗",bakkie:"🚛",suv:"🚙",van:"🚐",luxury:"🏎️"})[r]||"🚗";return S?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-700 rounded w-1/3 mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"h-96 bg-gray-300 dark:bg-gray-700 rounded-lg mb-6"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"})]}),e.jsx("div",{className:"h-96 bg-gray-300 dark:bg-gray-700 rounded-lg"})]})]})})}):t?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("nav",{className:"mb-8",children:e.jsxs("ol",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>d("/"),className:"hover:text-primary-600",children:"Home"})}),e.jsx("li",{children:"/"}),e.jsx("li",{children:e.jsx("button",{onClick:()=>d("/search"),className:"hover:text-primary-600",children:"Search"})}),e.jsx("li",{children:"/"}),e.jsxs("li",{className:"text-gray-900 dark:text-white",children:[t.make," ",t.model]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.images[0],alt:`${t.make} ${t.model}`,className:"w-full h-96 object-cover rounded-lg"}),e.jsx("div",{className:"absolute top-4 left-4 bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm font-medium",children:C(t.type)}),e.jsxs("div",{className:"absolute top-4 right-4 bg-primary-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:[c(t.pricePerDay),"/day"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:t.images.slice(1,4).map((r,p)=>e.jsx("img",{src:r,alt:`${t.make} ${t.model} ${p+2}`,className:"w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity"},p))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:[t.make," ",t.model," ",t.year]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 flex items-center",children:["📍 ",t.location]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-yellow-400 text-xl",children:"⭐"}),e.jsx("span",{className:"ml-2 text-lg font-semibold text-gray-900 dark:text-white",children:t.rating}),e.jsxs("span",{className:"ml-1 text-gray-600 dark:text-gray-400",children:["(",t.reviewCount," reviews)"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[c(t.pricePerDay),"/day"]})]})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:t.description}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Features"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.features.map(r=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-full",children:r},r))})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Meet your host"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center mr-4",children:e.jsx("span",{className:"text-primary-600 text-lg font-medium",children:t.host.name.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.host.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-yellow-400",children:"⭐"}),e.jsxs("span",{className:"ml-1",children:[t.host.rating," • ",t.host.totalTrips," trips"]}),e.jsxs("span",{className:"ml-2",children:["• Responds in ",t.host.responseTime]})]})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 sticky top-24",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Book this vehicle"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pick-up Date"}),e.jsx("input",{type:"date",value:s.pickupDate,onChange:r=>m("pickupDate",r.target.value),min:new Date().toISOString().split("T")[0],className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Return Date"}),e.jsx("input",{type:"date",value:s.returnDate,onChange:r=>m("returnDate",r.target.value),min:s.pickupDate||new Date().toISOString().split("T")[0],className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),s.totalDays>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[c(t.pricePerDay)," × ",s.totalDays," days"]}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:c(t.pricePerDay*s.totalDays)})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Service fee"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:c(t.pricePerDay*s.totalDays*.1)})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total"}),e.jsx("span",{className:"text-xl font-bold text-primary-600",children:c(s.totalPrice*1.1)})]})})]}),e.jsx("button",{onClick:()=>u(!0),disabled:s.totalDays<=0,className:"w-full bg-primary-600 text-white py-3 px-4 rounded-md hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-semibold",children:i?"Request to Book":"Login to Book"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"You won't be charged until the host confirms your booking"})]})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Confirm your booking"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Special Requests (Optional)"}),e.jsx("textarea",{value:s.specialRequests,onChange:r=>f({...s,specialRequests:r.target.value}),rows:3,placeholder:"Any special requests or questions for the host...",className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[c(t.pricePerDay)," × ",s.totalDays," days"]}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:c(s.totalPrice)})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Service fee"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:c(s.totalPrice*.1)})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total"}),e.jsx("span",{className:"text-xl font-bold text-primary-600",children:c(s.totalPrice*1.1)})]})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:w,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:w?"Sending...":"Proceed to Payment"})]})]})]})}),j&&D&&e.jsx(F,{isOpen:j,onClose:()=>g(!1),bookingData:D,userInfo:{firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",email:(i==null?void 0:i.email)||"",phone:(i==null?void 0:i.phone)||""},onSuccess:y})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🚗"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Vehicle not found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"The vehicle you're looking for doesn't exist or has been removed."}),e.jsx("button",{onClick:()=>d("/search"),className:"bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 transition-colors",children:"Browse Vehicles"})]})})})};export{_ as default};
