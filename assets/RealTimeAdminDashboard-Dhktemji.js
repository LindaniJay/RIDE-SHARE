var T=Object.defineProperty;var O=(a,e,s)=>e in a?T(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var w=(a,e,s)=>O(a,typeof e!="symbol"?e+"":e,s);import{j as t}from"./query-CSyQ0w5Y.js";import{r as m}from"./vendor-CBH9K-97.js";import{I as j,a as U,u as k}from"./index-pzKCZDpe.js";const f=class f{constructor(){w(this,"errorLog",[])}static getInstance(){return f.instance||(f.instance=new f),f.instance}handleError(e,s){let i;return e instanceof Error?i={code:this.getErrorCode(e),message:e.message,details:{stack:e.stack,context:s,timestamp:new Date().toISOString()}}:typeof e=="string"?i={code:"UNKNOWN_ERROR",message:e,details:{context:s,timestamp:new Date().toISOString()}}:i={code:"UNKNOWN_ERROR",message:"An unknown error occurred",details:{context:s,timestamp:new Date().toISOString()}},this.logError(i),i}getErrorCode(e){return e.message.includes("fetch")?"NETWORK_ERROR":e.message.includes("timeout")?"TIMEOUT_ERROR":e.message.includes("unauthorized")?"AUTH_ERROR":e.message.includes("forbidden")?"PERMISSION_ERROR":e.message.includes("validation")||e.message.includes("required")?"VALIDATION_ERROR":"UNKNOWN_ERROR"}logError(e){this.errorLog.push(e),this.sendToLoggingService(e)}sendToLoggingService(e){console.log("Sending error to logging service:",e)}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}};w(f,"instance");let N=f;const A=N.getInstance(),$=a=>a.code==="NETWORK_ERROR"||a.code==="TIMEOUT_ERROR",P=a=>a.code==="AUTH_ERROR"||a.code==="PERMISSION_ERROR";class I{constructor(e="http://localhost:5001/api"){w(this,"baseURL");w(this,"defaultTimeout",1e4);w(this,"defaultRetries",3);this.baseURL=e}async request(e,s={}){const{timeout:i=this.defaultTimeout,retries:l=this.defaultRetries,...o}=s,u=`${this.baseURL}${e}`,d=new AbortController,g=setTimeout(()=>d.abort(),i),r={"Content-Type":"application/json",Accept:"application/json"},v=localStorage.getItem("authToken");v&&(r.Authorization=`Bearer ${v}`);const y={...o,headers:{...r,...o.headers},signal:d.signal};let h=null;for(let n=0;n<=l;n++)try{const c=await fetch(u,y);if(clearTimeout(g),!c.ok){const E=await c.json().catch(()=>({}));throw new Error(E.message||`HTTP ${c.status}: ${c.statusText}`)}return{success:!0,data:await c.json()}}catch(c){if(h=A.handleError(c,`API Request: ${e}`),P(h)||(c==null?void 0:c.status)<500||$(h)&&n>=l)break;n<l&&await this.delay(Math.pow(2,n)*1e3)}return clearTimeout(g),{success:!1,data:null,message:(h==null?void 0:h.message)||"Request failed",errors:[(h==null?void 0:h.message)||"Unknown error"]}}delay(e){return new Promise(s=>setTimeout(s,e))}async get(e,s){return this.request(e,{...s,method:"GET"})}async post(e,s,i){return this.request(e,{...i,method:"POST",body:s?JSON.stringify(s):void 0})}async put(e,s,i){return this.request(e,{...i,method:"PUT",body:s?JSON.stringify(s):void 0})}async patch(e,s,i){return this.request(e,{...i,method:"PATCH",body:s?JSON.stringify(s):void 0})}async delete(e,s){return this.request(e,{...s,method:"DELETE"})}async uploadFile(e,s,i,l){const o=new FormData;o.append("file",s),i&&Object.entries(i).forEach(([g,r])=>{o.append(g,r)});const u=localStorage.getItem("authToken"),d={};return u&&(d.Authorization=`Bearer ${u}`),this.request(e,{...l,method:"POST",body:o,headers:{...d,...l==null?void 0:l.headers}})}async getPaginated(e,s,i){const l=new URLSearchParams;s&&Object.entries(s).forEach(([d,g])=>{g!=null&&l.append(d,g.toString())});const o=l.toString(),u=o?`${e}?${o}`:e;return this.get(u,i)}async healthCheck(){try{return(await this.get("/health")).success}catch{return!1}}}const x=new I;class b{static async getUsers(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString()),e!=null&&e.status&&s.append("status",e.status),e!=null&&e.role&&s.append("role",e.role);const i=`/admin/users${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}static async approveUser(e,s,i){return(await x.patch(`/admin/users/${e}/approve`,{status:s,reason:i})).data}static async getVehicles(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString()),e!=null&&e.status&&s.append("status",e.status);const i=`/admin/vehicles${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}static async approveVehicle(e,s,i){return(await x.patch(`/admin/vehicles/${e}/approve`,{status:s,reason:i})).data}static async getBookings(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString()),e!=null&&e.status&&s.append("status",e.status);const i=`/admin/bookings${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}static async getReviews(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString());const i=`/admin/reviews${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}static async getStats(){return(await x.get("/admin/stats")).data.data}static async getDocuments(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString()),e!=null&&e.status&&s.append("status",e.status);const i=`/admin/documents${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}static async getDisputes(e){const s=new URLSearchParams;e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.limit&&s.append("limit",e.limit.toString()),e!=null&&e.status&&s.append("status",e.status);const i=`/admin/disputes${s.toString()?`?${s.toString()}`:""}`;return(await x.get(i)).data}}const S=({status:a,size:e="md",className:s=""})=>{const i=()=>{switch(a){case"approved":case"verified":case"confirmed":case"completed":return{bg:"bg-green-500/20",text:"text-green-300",border:"border-green-500/30",icon:"✓"};case"pending":return{bg:"bg-yellow-500/20",text:"text-yellow-300",border:"border-yellow-500/30",icon:"Clock"};case"rejected":case"declined":case"cancelled":return{bg:"bg-red-500/20",text:"text-red-300",border:"border-red-500/30",icon:"✗"};case"unverified":return{bg:"bg-gray-500/20",text:"text-gray-300",border:"border-gray-500/30",icon:"○"};default:return{bg:"bg-gray-500/20",text:"text-gray-300",border:"border-gray-500/30",icon:"?"}}},l=()=>{switch(e){case"sm":return"px-2 py-1 text-xs";case"md":return"px-3 py-1 text-sm";case"lg":return"px-4 py-2 text-base";default:return"px-3 py-1 text-sm"}},o=i();return t.jsxs("span",{className:`
        inline-flex items-center space-x-1 rounded-full font-medium border
        ${o.bg} ${o.text} ${o.border} ${l()}
        ${s}
      `,children:[t.jsx(j,{name:o.icon,size:"sm"}),t.jsx("span",{className:"capitalize",children:a})]})},R=({type:a,onRefresh:e})=>{const[s,i]=m.useState([]),[l,o]=m.useState(!0),[u,d]=m.useState(null),{success:g,error:r}=U();m.useEffect(()=>{v()},[a]);const v=async()=>{o(!0);try{let n;a==="users"?n=await b.getUsers({status:"pending"}):n=await b.getVehicles({status:"pending"}),n.success?i(n.data[a]||[]):r("Failed to fetch items",n.message||"Unknown error")}catch(n){r("Error fetching items",n.message||"Unknown error")}finally{o(!1)}},y=async n=>{d(n);try{let c;a==="users"?c=await b.approveUser(n,"approved"):c=await b.approveVehicle(n,"approved"),c.success?(g("Item approved",`${a==="users"?"User":"Vehicle"} has been approved`),v(),e==null||e()):r("Approval failed",c.message||"Unknown error")}catch(c){r("Approval failed",c.message||"Unknown error")}finally{d(null)}},h=async(n,c)=>{d(n);try{let p;a==="users"?p=await b.approveUser(n,"rejected",c):p=await b.approveVehicle(n,"declined",c),p.success?(g("Item rejected",`${a==="users"?"User":"Vehicle"} has been rejected`),v(),e==null||e()):r("Rejection failed",p.message||"Unknown error")}catch(p){r("Rejection failed",p.message||"Unknown error")}finally{d(null)}};return l?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Pending ",a==="users"?"User":"Vehicle"," Approvals (",s.length,")"]}),s.length===0?t.jsxs("div",{className:"text-center py-8 text-gray-400",children:["No pending ",a," for approval"]}):t.jsx("div",{className:"space-y-3",children:s.map(n=>t.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex-1",children:a==="users"?t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-white",children:[n.firstName," ",n.lastName]}),t.jsx("p",{className:"text-sm text-gray-300",children:n.email}),t.jsx("p",{className:"text-sm text-gray-400 capitalize",children:n.role}),t.jsx(S,{status:n.approvalStatus})]}):t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-white",children:n.title}),t.jsxs("p",{className:"text-sm text-gray-300",children:[n.make," ",n.model," (",n.year,")"]}),t.jsxs("p",{className:"text-sm text-gray-400",children:["R",n.pricePerDay,"/day"]}),t.jsx(S,{status:n.status})]})}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>y(n.id),disabled:u===n.id,className:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 text-sm",children:u===n.id?"...":"Approve"}),t.jsx("button",{onClick:()=>{const c=prompt("Rejection reason (optional):");c!==null&&h(n.id,c)},disabled:u===n.id,className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 text-sm",children:u===n.id?"...":"Reject"})]})]})},n.id))})]})},L=()=>{const{user:a}=k(),[e,s]=m.useState(null),[i,l]=m.useState(!0),[o,u]=m.useState("overview");m.useEffect(()=>{d();const r=setInterval(d,3e4);return()=>clearInterval(r)},[]);const d=async()=>{try{const r=await b.getStats();s(r)}catch(r){console.error("Error fetching admin stats:",r)}finally{l(!1)}},g=()=>{d()};return i?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Admin Dashboard"}),t.jsx("p",{className:"text-gray-300",children:"Real-time management of RideShare SA platform"}),t.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Welcome, ",a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]})]}),e&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-lg p-6 border border-white/20",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"}),t.jsx("p",{className:"text-2xl font-bold text-white",children:e.overview.totalUsers})]}),t.jsx(j,{name:"users",className:"h-8 w-8 text-blue-400"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-red-400 text-sm",children:[e.overview.pendingUsers," pending approval"]})})]}),t.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-lg p-6 border border-white/20",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-300 text-sm",children:"Total Vehicles"}),t.jsx("p",{className:"text-2xl font-bold text-white",children:e.overview.totalVehicles})]}),t.jsx(j,{name:"car",className:"h-8 w-8 text-green-400"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-red-400 text-sm",children:[e.overview.pendingVehicles," pending approval"]})})]}),t.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-lg p-6 border border-white/20",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-300 text-sm",children:"Total Bookings"}),t.jsx("p",{className:"text-2xl font-bold text-white",children:e.overview.totalBookings})]}),t.jsx(j,{name:"calendar",className:"h-8 w-8 text-purple-400"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-yellow-400 text-sm",children:[e.overview.pendingBookings," pending"]})})]}),t.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-lg p-6 border border-white/20",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"}),t.jsxs("p",{className:"text-2xl font-bold text-white",children:["R",e.overview.totalRevenue.toLocaleString()]})]}),t.jsx(j,{name:"dollar-sign",className:"h-8 w-8 text-yellow-400"})]})})]}),t.jsx("div",{className:"mb-6",children:t.jsx("div",{className:"flex space-x-1 bg-white/10 backdrop-blur-md rounded-lg p-1 border border-white/20",children:[{id:"overview",label:"Overview",icon:"bar-chart"},{id:"users",label:"User Approvals",icon:"users"},{id:"vehicles",label:"Vehicle Approvals",icon:"car"}].map(r=>t.jsxs("button",{onClick:()=>u(r.id),className:`flex items-center space-x-2 px-4 py-2 rounded-md transition-all ${o===r.id?"bg-white/20 text-white":"text-gray-300 hover:text-white hover:bg-white/10"}`,children:[t.jsx(j,{name:r.icon,className:"h-4 w-4"}),t.jsx("span",{children:r.label})]},r.id))})}),t.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:[o==="overview"&&t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Platform Overview"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Recent User Registrations"}),t.jsx("div",{className:"space-y-2",children:e==null?void 0:e.recentActivity.recentUsers.slice(0,5).map(r=>t.jsxs("div",{className:"flex items-center justify-between bg-white/5 rounded-lg p-3",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-white font-medium",children:[r.firstName," ",r.lastName]}),t.jsx("p",{className:"text-gray-400 text-sm",children:r.email})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${r.approvalStatus==="pending"?"bg-yellow-500/20 text-yellow-400":r.approvalStatus==="approved"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:r.approvalStatus})]},r.id))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Recent Vehicle Listings"}),t.jsx("div",{className:"space-y-2",children:e==null?void 0:e.recentActivity.recentVehicles.slice(0,5).map(r=>t.jsxs("div",{className:"flex items-center justify-between bg-white/5 rounded-lg p-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-white font-medium",children:r.title}),t.jsxs("p",{className:"text-gray-400 text-sm",children:[r.make," ",r.model]})]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${r.status==="pending"?"bg-yellow-500/20 text-yellow-400":r.status==="approved"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:r.status})]},r.id))})]})]})]}),o==="users"&&t.jsx("div",{className:"p-6",children:t.jsx(R,{type:"users",onRefresh:g})}),o==="vehicles"&&t.jsx("div",{className:"p-6",children:t.jsx(R,{type:"vehicles",onRefresh:g})})]})]})})},_=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{L as R,S,_ as a};
