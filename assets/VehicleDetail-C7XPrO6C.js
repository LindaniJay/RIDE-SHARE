import{r as e,j as a,v as t,u as s}from"./react-vendor-CsyM86xr.js";import{p as r,I as i,u as l,v as d}from"./admin-pages-uBlL0uRW.js";import"./vendor-BLLdzSkb.js";import"./utils-Bi8vyz5k.js";import"./firebase-COrkt_lY.js";const n=new class{storageKey="rideshare_bookings";getStoredBookings(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch(e){return[]}}saveBookings(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(a){}}async createBooking(e){const a={id:`booking_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...e,status:"pending",createdAt:(new Date).toISOString(),paymentStatus:"pending"},t=[...this.getStoredBookings(),a];return this.saveBookings(t),window.dispatchEvent(new CustomEvent("bookingCreated",{detail:a})),a}async getRenterBookings(e){return this.getStoredBookings().filter(a=>a.renterId===e)}async updatePaymentStatus(e,a){const t=this.getStoredBookings(),s=t.findIndex(a=>a.id===e);if(-1===s)throw new Error("Booking not found");return t[s].paymentStatus=a,"paid"===a&&(t[s].status="confirmed"),this.saveBookings(t),window.dispatchEvent(new CustomEvent("bookingUpdated",{detail:t[s]})),t[s]}},o=({isOpen:t,onClose:s,bookingData:l,userInfo:d,onSuccess:n})=>{const[o,c]=e.useState([]),[m,x]=e.useState(""),[g,h]=e.useState(!1),[y,p]=e.useState("");e.useEffect(()=>{t&&u()},[t]);const u=async()=>{try{const e=await r.getPaymentMethods();c(e.data.methods||[]),x("payfast")}catch(e){}};return t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Complete Your Booking"}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"✕"})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:l.vehicleName}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:[l.pickupDate," - ",l.returnDate]}),a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["Total: ",(b=l.totalAmount,`R${b.toLocaleString()}`)]})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Choose Payment Method"}),a.jsx("div",{className:"space-y-3",children:o.map(e=>a.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer transition-colors "+(m===e.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"),children:[a.jsx("input",{type:"radio",name:"paymentMethod",value:e.id,checked:m===e.id,onChange:e=>x(e.target.value),className:"mr-3 text-primary-600 focus:ring-primary-500"}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-2xl mr-3",children:e.icon}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.description})]})]})]},e.id))})]}),y&&a.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-3 mb-4",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:y})}),a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(i,{name:"Info",size:"sm",className:"text-blue-600 dark:text-blue-400 mr-2"}),a.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[a.jsx("p",{className:"font-medium mb-1",children:"Payment Security"}),a.jsx("p",{children:"Your payment is processed securely. You'll only be charged after the host confirms your booking. All transactions are protected by our insurance coverage."})]})]})}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:s,className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(m){h(!0),p("");try{if("stripe"===m)await r.createPaymentIntent(l.id,l.totalAmount),alert("Stripe integration would be implemented here"),n();else if("payfast"===m){const e={bookingId:parseInt(l.id),amount:l.totalAmount,firstName:d.firstName,lastName:d.lastName,email:d.email,cellNumber:d.phone},a=await r.createPayfastPayment(e),t=document.createElement("form");t.method="POST",t.action=a.data.paymentUrl,a.data.payfastData&&Object.entries(a.data.payfastData).forEach(([e,a])=>{const s=document.createElement("input");s.type="hidden",s.name=e,s.value=a,t.appendChild(s)}),document.body.appendChild(t),t.submit()}}catch(e){const a=e instanceof Error&&"response"in e?e.response?.data?.error:"Payment failed. Please try again.";p(a||"Payment failed. Please try again.")}finally{h(!1)}}else p("Please select a payment method")},disabled:g||!m,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:g?"Processing...":"Pay Now"})]}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4",children:["By proceeding, you agree to our"," ",a.jsx("a",{href:"#",className:"text-primary-600 hover:text-primary-700",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"#",className:"text-primary-600 hover:text-primary-700",children:"Privacy Policy"})]})]})}):null;var b},c=()=>{const{id:r}=t(),c=s(),{user:m}=l(),[x,g]=e.useState(null),[h,y]=e.useState(!0),[p,u]=e.useState({pickupDate:"",returnDate:"",totalDays:0,totalPrice:0,specialRequests:""}),[b,f]=e.useState(!1),[j,k]=e.useState(!1),[v,N]=e.useState(!1),[w,D]=e.useState(null);e.useEffect(()=>{S()},[r]);const S=async()=>{y(!0);try{const e=await d.getById(r);g(e.data)}catch(e){g({id:r,make:"Toyota",model:"Hilux",year:2022,type:"bakkie",pricePerDay:250,location:"Cape Town, South Africa",images:["https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=800","https://images.unsplash.com/photo-1549317336-206569e8475c?w=800","https://images.unsplash.com/photo-1555215695-3004980dd54e?w=800"],features:["4WD","Air Conditioning","Bluetooth","GPS Navigation","Leather Seats","Backup Camera"],rating:4.8,reviewCount:24,description:"Perfect for your South African adventure! This reliable Toyota Hilux is ideal for exploring the beautiful landscapes of the Western Cape. With 4WD capabilities and all the modern features you need, it's perfect for both city driving and off-road adventures.",host:{id:"host1",name:"John M.",rating:4.9,responseTime:"1 hour",joinDate:"2022-03-15",totalTrips:47},availability:{startDate:"2024-01-01",endDate:"2024-12-31"}})}finally{y(!1)}},P=(e,a)=>{const t={...p,[e]:a};if(t.pickupDate&&t.returnDate){const e=new Date(t.pickupDate),a=new Date(t.returnDate),s=Math.ceil((a.getTime()-e.getTime())/864e5);t.totalDays=s>0?s:0,t.totalPrice=t.totalDays*(x?.pricePerDay||0)}u(t)},C=e=>`R${e.toLocaleString()}`;return h?a.jsx("div",{className:"page-background py-8",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-700 rounded w-1/3 mb-8"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("div",{className:"h-96 bg-gray-300 dark:bg-gray-700 rounded-lg mb-6"}),a.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded mb-2"}),a.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"})]}),a.jsx("div",{className:"h-96 bg-gray-300 dark:bg-gray-700 rounded-lg"})]})]})})}):x?a.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsx("nav",{className:"mb-8",children:a.jsxs("ol",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[a.jsx("li",{children:a.jsx("button",{onClick:()=>c("/"),className:"hover:text-primary-600",children:"Home"})}),a.jsx("li",{children:"/"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>c("/search"),className:"hover:text-primary-600",children:"Search"})}),a.jsx("li",{children:"/"}),a.jsxs("li",{className:"text-gray-900 dark:text-white",children:[x.make," ",x.model]})]})}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:x.images[0],alt:`${x.make} ${x.model}`,className:"w-full h-96 object-cover rounded-lg"}),a.jsx("div",{className:"absolute top-4 left-4 bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm font-medium",children:(B=x.type,{car:"Car",bakkie:"Car",suv:"Car",van:"Car",luxury:"Car"}[B]||"Car")}),a.jsxs("div",{className:"absolute top-4 right-4 bg-primary-600 text-white px-3 py-1 rounded-full text-sm font-medium",children:[C(x.pricePerDay),"/day"]})]}),a.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4",children:x.images.slice(1,4).map((e,t)=>a.jsx("img",{src:e,alt:`${x.make} ${x.model} ${t+2}`,className:"w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity"},t))})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:[x.make," ",x.model," ",x.year]}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 flex items-center",children:[a.jsx(i,{name:"MapPin",size:"sm",className:"mr-1"}),x.location]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx(i,{name:"Star",size:"sm",className:"text-yellow-400"}),a.jsx("span",{className:"ml-2 text-lg font-semibold text-gray-900 dark:text-white",children:x.rating}),a.jsxs("span",{className:"ml-1 text-gray-600 dark:text-gray-400",children:["(",x.reviewCount," reviews)"]})]}),a.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[C(x.pricePerDay),"/day"]})]})]}),a.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:x.description}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Features"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:x.features.map(e=>a.jsx("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-full",children:e},e))})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Meet your host"}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-12 h-12 bg-primary-100 dark:bg-primary-900 rounded-full flex items-center justify-center mr-4",children:a.jsx("span",{className:"text-primary-600 text-lg font-medium",children:x.host.name.charAt(0)})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:x.host.name}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[a.jsx(i,{name:"Star",size:"sm",className:"text-yellow-400"}),a.jsxs("span",{className:"ml-1",children:[x.host.rating," • ",x.host.totalTrips," trips"]}),a.jsxs("span",{className:"ml-2",children:["• Responds in ",x.host.responseTime]})]})]})]})]})]})]}),a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 sticky top-24",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Book this vehicle"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pick-up Date"}),a.jsx("input",{type:"date",value:p.pickupDate,onChange:e=>P("pickupDate",e.target.value),min:(new Date).toISOString().split("T")[0],className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Return Date"}),a.jsx("input",{type:"date",value:p.returnDate,onChange:e=>P("returnDate",e.target.value),min:p.pickupDate||(new Date).toISOString().split("T")[0],className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),p.totalDays>0&&a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[C(x.pricePerDay)," × ",p.totalDays," days"]}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:C(x.pricePerDay*p.totalDays)})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Service fee"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:C(x.pricePerDay*p.totalDays*.1)})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total"}),a.jsx("span",{className:"text-xl font-bold text-primary-600",children:C(1.1*p.totalPrice)})]})})]}),a.jsx("button",{onClick:()=>f(!0),disabled:p.totalDays<=0||m&&"approved"!==m.approvalStatus||!1,className:`w-full py-3 px-4 rounded-md transition-colors font-semibold ${m&&"approved"!==m.approvalStatus?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-primary-600 text-white hover:bg-primary-700"} disabled:bg-gray-400 disabled:cursor-not-allowed`,children:m?"approved"===m.approvalStatus?"Request to Book":"pending"===m.approvalStatus?"Account Pending Verification":"Account Needs Verification":"Login to Book"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"You won't be charged until the host confirms your booking"})]})]})})]}),b&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Confirm your booking"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Special Requests (Optional)"}),a.jsx("textarea",{value:p.specialRequests,onChange:e=>u({...p,specialRequests:e.target.value}),rows:3,placeholder:"Any special requests or questions for the host...",className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500"})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[C(x.pricePerDay)," × ",p.totalDays," days"]}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:C(p.totalPrice)})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Service fee"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:C(.1*p.totalPrice)})]}),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total"}),a.jsx("span",{className:"text-xl font-bold text-primary-600",children:C(1.1*p.totalPrice)})]})})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{onClick:()=>f(!1),className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(m){if("approved"!==m.approvalStatus)return alert("Your account needs to be verified before you can make bookings. Please upload your documents and wait for approval."),void c("/dashboard");if(!x||p.totalDays<=0)alert("Please select valid dates");else{N(!0);try{const e={vehicleId:x.id,startDate:p.pickupDate,endDate:p.returnDate,totalDays:p.totalDays,totalPrice:p.totalPrice,specialRequests:p.specialRequests,renterId:m.id,renterName:`${m.firstName} ${m.lastName}`,hostId:x.host?.id||"host-1",hostName:x.host?.name||"Vehicle Host",vehicleTitle:`${x.make} ${x.model}`,vehicleImage:x.images[0]||"/images/default-vehicle.jpg",vehicleMake:x.make,vehicleModel:x.model},a=await n.createBooking(e);D({id:a.id,totalAmount:1.1*p.totalPrice,vehicleName:`${x.make} ${x.model}`,pickupDate:p.pickupDate,returnDate:p.returnDate}),f(!1),k(!0)}catch(e){alert("Failed to create booking. Please try again.")}finally{N(!1)}}}else c("/")},disabled:v,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:v?"Sending...":"Proceed to Payment"})]})]})]})}),j&&w&&a.jsx(o,{isOpen:j,onClose:()=>k(!1),bookingData:w,userInfo:{firstName:m?.firstName||"",lastName:m?.lastName||"",email:m?.email||"",phone:m?.phone||""},onSuccess:async()=>{if(k(!1),w)try{await n.updatePaymentStatus(w.id,"paid"),alert("Payment successful! Your booking is confirmed and will appear on your dashboard.")}catch(e){alert("Payment successful! Your booking is confirmed.")}c("/dashboard")}})]})}):a.jsx("div",{className:"page-background py-8",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"mb-4",children:a.jsx(i,{name:"Car",size:"lg",className:"text-gray-400 mx-auto"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Vehicle not found"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"The vehicle you're looking for doesn't exist or has been removed."}),a.jsx("button",{onClick:()=>c("/search"),className:"bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 transition-colors",children:"Browse Vehicles"})]})})});var B};export{c as default};
